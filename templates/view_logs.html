{% extends "base.html" %}

{% block title %}View Logs{% endblock %}

{% block content %}
<h1 class="text-3xl mb-5">View Logs</h1>
<form action="/view-logs" method="get">
    <label for="phone_number" class="block mb-2">Search by Phone Number:</label>
    <input type="text" id="phone_number" name="phone_number" value="{{ phone_number if phone_number else '' }}"
        placeholder="Enter phone number" class="bg-gray-200 rounded-lg p-2 mb-4">
    <button type="submit" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-800">Search</button>
</form>

<ul class="mt-4">
    {% if users %}
    {% for user in users %}
    <li class="mb-4 p-4 border rounded-lg shadow-md">
        <h2 class="text-xl font-bold mb-2">User: {{ user.phone_number }}</h2>
        {% if user.messages %}
        <div class="flex flex-col gap-4">
            {% for group in user.messages %}
            <div class="p-2 bg-gray-100 rounded-lg flex gap-3 items-start">
                {% for entry in group %}
                <div class="p-2 bg-gray-200 rounded-lg mb-2">
                    {% if entry.role.startswith('+') %}
                    <p class="font-semibold">User:</p>
                    {% else %}
                    <p class="font-semibold">Assistant:</p>
                    {% endif %}
                    <p>{{ entry.content }}</p>
                    {% if entry.formatted_timestamp %}
                    <p class="text-gray-500 text-sm mt-2">Timestamp: {{ entry.formatted_timestamp }}</p>
                    {% else %}
                    <p class="text-gray-500 text-sm mt-2">Timestamp not available</p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>No messages found.</p>
        {% endif %}
    </li>
    {% endfor %}
    {% else %}
    <li>No users found.</li>
    {% endif %}
</ul>

<div class="mt-4">
    <nav class="flex gap-3 justify-between">
        <!-- Previous Page Link -->
        <a href="{{ '?page=' ~ (page - 1) ~ '&per_page=' ~ per_page if has_prev_page else '#' }}"
           class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-700 {% if not has_prev_page %}cursor-not-allowed opacity-50{% endif %}"
           {% if not has_prev_page %} aria-disabled="true" {% endif %}>
           Previous
        </a>

        <!-- Page Info -->
        <span class="px-4 py-2 bg-gray-200 rounded-lg">
            Page {{ page }} of {{ (total_users // per_page) + (1 if total_users % per_page > 0 else 0) }}
        </span>

        <!-- Next Page Link -->
        <a href="{{ '?page=' ~ (page + 1) ~ '&per_page=' ~ per_page if has_next_page else '#' }}"
           class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-700 {% if not has_next_page %}cursor-not-allowed opacity-50{% endif %}"
           {% if not has_next_page %} aria-disabled="true" {% endif %}>
           Next
        </a>
    </nav>
</div>


{% endblock %}
